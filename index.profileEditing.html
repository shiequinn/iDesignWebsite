<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fortawesome.github.io/Font-Awesome/assets/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <title>Edit profile - iDesign Web Developer Company</title>
</head>
<body>
    <div class="backToHome">
        <a href="index.html" class="backToHomeLink"><i class="fas fa-home"></i> Back to Home</a>
    </div>
    <div class="members-container">
        <div class="members-header">
            <h1>Edit Your Profile</h1>
            <p>Update your account information and membership level.</p>
        </div>
  
        <div class="members-content">
            <form id="profileForm" class="profile-form">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>

                <label for="bio">Bio:</label>
                <textarea id="bio" name="bio"></textarea>

                <label for="membership">Membership Level:</label>
                <select id="membership" name="membership">
                    <option value="basic">Basic</option>
                    <option value="premium">Premium</option>
                </select>
                <label for="password">New Password:</label>
                <input type="password" id="password" name="password" placeholder="Leave blank to keep current password">

                <button type="submit">Update Profile</button>
            </form>
          </div> 

</div>
<script>
    // Redirect to login if not authenticated
    if (!localStorage.getItem('token')) {
        window.location.href = 'index.login.html';
    }
// Load user info
fetch('https://idesignwebdeveloper.shiequinn.com/.netlify/functions/get-user-info')
  .then(res => res.json())
  .then(data => {
    document.getElementById('username').value = data.username;
    document.getElementById('email').value = data.email;
    document.getElementById('bio').value = data.bio;
    document.getElementById('membership').value = data.membership; // "basic" or "premium"
  });

// Handle profile update
document.getElementById('profileForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const updatedData = {
    username: document.getElementById('username').value,
    email: document.getElementById('email').value,
    bio: document.getElementById('bio').value,
    membership: document.getElementById('membership').value,
    password: document.getElementById('password').value
  };

  fetch('https://idesignwebdeveloper.shiequinn.com/.netlify/functions/update-user-info', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(updatedData),
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert('Profile updated successfully!');
      window.location.href = 'index.members.html';
    } else {
      alert('Error updating profile.');
    }
  })
  .catch(err => {
    console.error('Fetch error:', err);
    alert('Could not load profile info.');
  });
});
</script>
</body>
</html>
